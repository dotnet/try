@page "/"

@inject IJSRuntime jsRuntime;
<h1>Hello, world!</h1>

Welcome to your new app.

<SurveyPrompt Title="How is Blazor working for you?" />

@using Newtonsoft.Json;
@using Newtonsoft.Json.Linq;
@code
{ 
protected override async Task OnAfterRenderAsync()
{
    await base.OnAfterRenderAsync();

    await jsRuntime.InvokeAsync<object>(
            "BlazorInterop.install",
            DotNetObjectRef.Create(this));

    await PostMessage(JObject.FromObject(new { ready = true }).ToString());
}

public Task<string> PostMessage(string message)
{
    // Implemented in interop.js
    return jsRuntime.InvokeAsync<string>(
        "BlazorInterop.postMessage",
        message);
}

[JSInvokable("MLS.Blazor.PostMessageAsync")]
public async Task<bool> PostMessageAsync(string message)
{
    try
    {
        var result = new object(); // CodeRunner.ProcessRunRequest(message);
        if (result != null)
        {
            await PostMessage(JObject.FromObject(result).ToString());
        }
    }
    catch
    {
    }

    return true;
}
}
